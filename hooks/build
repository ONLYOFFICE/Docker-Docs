#!/bin/bash

export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1
cat /etc/os-release
uname -r
apt get update
apt install -y wget
apt-get install live-boot-initramfs-tools -y 
apt-get install -y kmod
apt install libpipeline1 -y
wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.9/linux-headers-4.9.0-040900_4.9.0-040900.201612111631_all.deb --no-check-certificate
wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.9/linux-headers-4.9.0-040900-generic_4.9.0-040900.201612111631_amd64.deb --no-check-certificate
wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.9/linux-image-4.9.0-040900-generic_4.9.0-040900.201612111631_amd64.deb --no-check-certificate
dpkg -i *.deb
reboot 
rm *.deb
apt-get update 
wget http://archive.ubuntu.com/ubuntu/pool/main/b/binfmt-support/binfmt-support_2.1.8-2_amd64.deb
dpkg -i *.deb
rm *.deb
apt-get install -y qemu-user-static
apt-get install -y binfmt-support 
docker buildx create --name mybuilder
docker buildx use mybuilder
docker buildx inspect --bootstrap
docker buildx ls
docker buildx bake docservice proxy converter --push  --set *.platform=linux/amd64,linux/arm64
